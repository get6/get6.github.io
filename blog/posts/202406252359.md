---
title: NestJS + JEST í™˜ê²½ì—ì„œ í•œêµ­ ì‹œê°„ìœ¼ë¡œ ë‚ ì§œ í‘œì‹œí•˜ê¸° (ì´ˆê°„ë‹¨!)
date: 2024-06-25 23:59
tags:
  - backend
  - typescript
  - nestjs
  - jest
---

![photo by Alexander Mass on Unsplash](https://images.unsplash.com/photo-1718305028213-96811fc88d16?crop=entropy&cs=srgb&fm=jpg&ixid=M3wzNjM5Nzd8MHwxfHJhbmRvbXx8fHx8fHx8fDE3MTkzMjc1NTZ8&ixlib=rb-4.0.3&q=85&w=768&h=432)

## ì™œ jestë¥¼ ì“°ê³ ìž í–ˆë‚˜
ì´ë²ˆì— ê°œì¸ ì„œë²„ë¥¼ ë§Œë“¤ë©´ì„œ í…ŒìŠ¤íŠ¸ ìœ„ì£¼ì˜ ê°œë°œì„ í•´ë³´ê¸°ë¡œ ë§ˆìŒë¨¹ì—ˆì–´ìš”.
ì›ëž˜ë¼ë©´ ë™ìž‘ì´ ë˜ëŠ”ì§€ í™•ì¸í•˜ê³  ì­‰ì­‰ ê°œë°œí•˜ë©´ ëëŠ”ë°, `.spec.ts` íŒŒì¼ì„ ë§Œë“¤ì–´ì„œ í•˜ë‚˜ì”© ì‹œë„í•˜ë‹¤ ë³´ë‹ˆ ê´€ë ¨ ì„¤ì •ì„ ìž¡ëŠ”ë° ì•Œì•„ë³´ëŠ” ì‹œê°„ì´ êµ‰ìž¥ížˆ ê¸¸ì–´ì¡Œì–´ìš”. ì§€ê¸ˆ ìŸëŠ” ì´ ì‹œê°„ì´ ë‚˜ì¤‘ì— ë” ë¹ ë¥´ê²Œ ê°œë°œí•  ë°©ë²•ì´ë¼ ìƒê°í•˜ë©´ì„œ ë°°ìš°ê³  ìžˆì–´ìš”.

jestì˜ ìž¥ì ì´ì•¼ ë‹¤ë¥¸ ê¸€ì—ì„œ ë§Žì´ ì„¤ëª…í•˜ê³  ìžˆì§€ë§Œ ì œê°€ ìƒê°í–ˆì„ ë• ì •ë§ ìž‘ì€ ë‹¨ìœ„ë¡œ í…ŒìŠ¤íŠ¸í•´ ë³¼ ìˆ˜ ìžˆëŠ” í™˜ê²½ì„ ë§Œë“¤ ìˆ˜ ìžˆëŠ” ê²ƒì´ ìž¥ì ì´ë¼ê³  ìƒê°í•´ìš”. í° ê·œëª¨ì— ì„œë¹„ìŠ¤ì—ì„œ ì–´ë–¤ ê¸°ëŠ¥ì„ ë§Œë“¤ê¸° ìœ„í•´ì„  í° ê¸°ëŠ¥ë¶€í„° ë§Œë“¤ì§€ ì•Šê³  ì—¬ëŸ¬ í•¨ìˆ˜ë¥¼ ë§Œë“¤ì–´ì„œ ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ ê°ˆ í…ë°ìš”. ê·¸ëŸ´ ë•Œ jestë¥¼ ì‚¬ìš©í•´ì„œ êµ¬í˜„í•œ í•¨ìˆ˜ í•˜ë‚˜ì”© í™•ì¸í•´ ë³´ëŠ” ê²ƒì´ ì •ë§ ì´ìƒì ì¸ ê°œë°œì¸ ê²ƒì²˜ëŸ¼ ëŠê»´ì¡Œì–´ìš”. ë§ˆì¹˜ í„°ë¯¸ë„ë¡œ í™•ì¸í•˜ëŠ” Cë‚˜ C++ í”„ë¡œê·¸ëž¨ì„ ë§Œë“¤ ë•Œì™€ ê°™ì€ ëŠë‚Œìœ¼ë¡œ ê°œë°œí•  ìˆ˜ ìžˆì–´ì„œ ê²°ê³¼ë¥¼ í™•ì¸í•˜ê¸° ì‰¬ìš´ ê²Œ ì •ë§ ì¢‹ë‹¤ê³  ìƒê°í•´ìš”.

í”„ë¡ íŠ¸ì—”ë“œëž‘ ë°±ì—”ë“œë¥¼ í”„ë ˆìž„ì›Œí¬ë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ê°œë°œí•˜ë‹¤ ë³´ë©´ ì´ëŸ° ìž‘ì€ í…ŒìŠ¤íŠ¸ë¥¼ ë¸Œë¼ìš°ì €ë‚˜ í¬ìŠ¤íŠ¸ë§¨ ê°™ì€ í”„ë¡œê·¸ëž¨ì„ í†µí•´ í™•ì¸í•˜ê²Œ ë˜ë”ë¼êµ¬ìš”.
ê³„ì† ì´ë ‡ê²Œ ê°œë°œí•˜ëŠ” ê´€ì„±ì„ ë²„ë ¤ë³´ê³ ìž í–ˆì–´ìš”. ë°”ì˜ë‹¤ëŠ” í•‘ê³„ë¡œ, ì„¤ì •ì„ ìž¡ê¸° ì–´ë µë‹¤ëŠ” ì´ìœ ë¡œ ë¯¸ë¤„ì™”ì§€ë§Œ ì§€ê¸ˆ ë‹¹ìž¥ì€ ê°œë°œì— ì „ë…í•  ìˆ˜ ìžˆëŠ” ì‹œê°„ì´ ë§Žì•„ì„œ ë„ì „í•´ ë³´ê¸°ë¡œ í–ˆì–´ìš”.
## ì‹œê°„ ì„¤ì •í•˜ê¸° ì „ ì‹œë„í•œ ë°©ë²•
ì €ëŠ” jest ë²„ì „ìœ¼ë¡œ `^29.5.0`ì„ ì‚¬ìš©í•˜ê³  ìžˆì–´ìš”.
envê°’ì„ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì“°ëŠ” ë²•, ConfigServiceë¥¼ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì“°ëŠ” ë²•, contants ë³€ìˆ˜ë“¤ì„ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë²•, í•˜ìœ„ serviceë“¤ì„ í…ŒìŠ¤íŠ¸í•˜ëŠ” ë°©ë²•ê³¼ ìƒìœ„ ì„œë¹„ìŠ¤ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë²• ë“±ì„ jestë¥¼ ì‚¬ìš©í•˜ë©´ì„œ ì•Œê²Œ ë˜ì—ˆì§€ë§Œ, ì´ë²ˆì—ëŠ” ì‹œê°„ ì„¤ì •í•˜ëŠ” ë²•ì— ì• ë¥¼ ë¨¹ì–´ì„œ ì´ê±¸ ê¸€ë¡œ ì¨ë³´ìž í–ˆê³  ì´ ë¶€ë¶„ë§Œ ì„¤ëª…í•˜ë ¤ê³  í•´ìš”.

ë¨¼ì € ì•Œë ¤ë“œë¦´ ì‚¬ì‹¤ë¡œëŠ” í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œ ì‹œê°„ì„ ì ìš©í•˜ëŠ” ì—¬ëŸ¬ ë°©ë²•ì„ ì‹œë„í•´ë„ UTC ì‹œê°„ìœ¼ë¡œë§Œ ë‚˜ì™€ì„œ ê°œë°œ í™˜ê²½ì—ì„œë„ ëŒë ¤ë´¤ì–´ìš”. ê°œë°œ í™˜ê²½ì—ì„œëŠ” `.env`ì— `TZ=Asia/Seoul`ë¥¼ ì¶”ê°€í•´ì„œ `yarn start`ë¡œ ëŒë ¤ë´¤ì„ ë•ŒëŠ” í•œêµ­ ì‹œê°„ìœ¼ë¡œ ì ìš©ë˜ì–´ì„œ ìž˜ ë‚˜ì™”ì–´ìš”. ê·¸ë ‡ì§€ë§Œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë§Œ ì•ˆ ë˜ëŠ” ê±¸ ê³ ì¹˜ê³  ì‹¶ì–´ì„œ ì°¾ì•„ë´¤ì–´ìš”.

ì œê°€ ì‹œë„í–ˆì§€ë§Œ, ì•ˆë˜ëŠ” ë°©ë²•ë“¤ì„ ì•Œë ¤ë“œë¦´ê²Œìš”. ì œê°€ ìž˜ ëª»í•œ ê±´ì§€ ì˜í–¥ì´ ì—†ëŠ” ê±´ì§„ ëª¨ë¥´ê² ì§€ë§Œ í•´ê²°ì±…ì€ ì•„ë‹ˆì—ˆì–´ìš”.

**pacakge.jsonì— ìžˆëŠ” scriptsì— í™˜ê²½ë³€ìˆ˜ ì¶”ê°€**
pacakge.jsonì— test ìŠ¤í¬ë¦½íŠ¸ë“¤ì— `TZ=Asia/Seoul` ì¶”ê°€ë¥¼ í•´ë´¤ì§€ë§Œ, íš¨ê³¼ëŠ” ì—†ì—ˆì–´ìš”.
```json
{
	// ...ì¤‘ëžµ
	"test": "TZ=Asia/Seoul jest",
	"test:watch": "TZ=Asia/Seoul jest --watch",
}
```

**VS Code Extension ortaì˜ jest ì„¤ì • ì¶”ê°€**
ì €ëŠ” VS Code Extensionì¸ ortaì˜ jestë¡œ jestë¥¼ ëŒë¦¬ê³  ìžˆì–´ìš”. ê·¸ëž˜ì„œ `.vscode/settings.json`ì— ì•„ëž˜ì²˜ëŸ¼ ì¶”ê°€í•´ ë´¤ëŠ”ë°ë„ ì ìš©ë˜ì§€ ì•Šì•˜ì–´ìš”.
```json
// í…ŒìŠ¤íŠ¸ë¥¼ í•˜ë‚˜ë§Œ ëŒë¦¬ê³  ì‹¶ìœ¼ì‹¤ ë•Œ ì´ ì„¤ì •ì„ ì¶”ê°€í•˜ì„¸ìš”.
"jest.runMode": {
	"type": "on-demand",
},
"jest.nodeEnv": {
	"TZ": "Asia/Seoul" // UTC+9ë¡œ ì„¤ì •í•˜ê¸° ìœ„í•œ ì‹œë„
}
```

**package.jsonì— ìžˆëŠ” jestì— ì„¤ì • ì¶”ê°€**
ì´ ë¬¸ì œë¥¼ Geminiì—ê²Œë„ ë¬¼ì–´ë´¤ëŠ”ë° `pacakge.json`ì— ìžˆëŠ” jest í•­ëª©ì— ì•„ëž˜ ì½”ë“œë¥¼ ì¶”ê°€í•˜ë¼ê³  ì €ì—ê²Œ ì•Œë ¤ì¤¬ì–´ìš”. ê·¼ë° ì´ ì½”ë“œëŠ” timezoneì´ë¼ëŠ” ë³€ìˆ˜ë¥¼ jestê°€ ë°›ì§ˆ ì•Šì•„ì„œ ê²½ê³ ê°€ ëœ¨ê³  ì ìš©ë˜ì§€ ì•Šì•„ìš”.
```json
"jest":	{ 
	"testEnvironment": "node", // ì´ê±´ defaultë¼ ì§€ì›Œë„ ê´œì°®ì•„ìš”.
	"timezone": "Asia/Seoul" 
}
```

**í…ŒìŠ¤íŠ¸ì—ì„  ì¼ë‹¨ í•´ê²°ë˜ì§€ë§Œ, Date ê°ì²´ì— í•œêµ­ ì‹œê°„ ì¶”ê°€**
ë§ˆì§€ë§‰ìœ¼ë¡œ ì´ê±´ ê·¸ëƒ¥ í…ŒìŠ¤íŠ¸í•˜ëŠ” í•¨ìˆ˜ì¸ `generateRandomDate`ì— 9ë¥¼ ë”í•´ì£¼ëŠ” ê±°ì˜€ì–´ìš”.
```typescript
const generateRandomDate = (hour: number) => {
	const today = new Date();
	const minute = Math.floor(Math.random() * 59);
	const second = Math.floor(Math.random() * 59);
	today.setHours(9 + hour, minute, second, 0);
	
	return today;
};
```
`today.setHours(9 + ì§€ì •í•  ì‹œê°„)`ìœ¼ë¡œ í•´ê²°í–ˆì§€ë§Œ ì´ê±´ ì´ í•¨ìˆ˜ì—ë§Œ ì ìš©í•œ ê±°ê³  ë¹„ìŠ·í•œ ê²½ìš°ì—ë„ ë˜ ë„£ì–´ì¤˜ì•¼ í•  ê²ƒ ê°™ì•˜ì–´ìš”. ê·¸ë¦¬ê³  **ê°œë°œ í™˜ê²½ì—ì„œëŠ” ì´ë¯¸ ì„¤ì •í•œ íƒ€ìž„ì¡´ ë•Œë¬¸ì— í•œêµ­ ì‹œê°„ + 9ì‹œê°„**ì¸ê²Œ ë¬¸ì œë¼ ë‹¤ë¥¸ ë°©ë²•ì„ ì°¾ì•˜ì–´ìš”.
## ì‹œê°„ ì„¤ì •í•˜ëŠ” ë°©ë²•
jestì—ì„œ ì‹œê°„ì„ ì„¤ì •í•˜ëŠ” ë°©ë²•ì€ ì•„ëž˜ì™€ ê°™ì•„ìš”. ì €ëŠ” í…ŒìŠ¤íŠ¸ë¡œ ì‹œê°„ì„ í™•ì¸í•´ì•¼ í•˜ëŠ” í•¨ìˆ˜ë“¤ì´ íŠ¹ì • ì„œë¹„ìŠ¤ íŒŒì¼ì— ìžˆì–´ì„œ `beforeEach`ì— ì¶”ê°€í–ˆì–´ìš”. ë§Œì•½ í•¨ìˆ˜ í•˜ë‚˜ì—ë§Œ ì‚¬ìš©í•˜ëŠ” ê²½ìš°ì—ëŠ” í•¨ìˆ˜ ì‹¤í–‰ ì „ì— ì´ê±¸ ì¶”ê°€í•˜ë©´ ë¼ìš” ðŸ˜ƒ
```typescript
beforeEach(async () => {
	const offset = -(new Date().getTimezoneOffset() / 60);
	// jest.useFakeTimers();
	jest.setSystemTime(new Date().getTime() + offset * 60 * 60 * 1000);
});

afterEach(() => {
	// jest.useRealTimers(); í•„ìš”í•œ ê²½ìš° ì¶”ê°€í•˜ì„¸ìš”!
});
```

offset ê°’ì€ -9ê°€ ë‚˜ì™€ìš”. ì´ ëœ»ì€ í˜„ìž¬ ë¡œì»¬ ì‹œê°„ëŒ€ê°€ UTCë³´ë‹¤ 9ì‹œê°„ ì•žì„œ ìžˆë‹¤ëŠ” ê±¸ ì˜ë¯¸ í•´ìš”(ê·¸ë ‡ì§€ë§Œ í•œêµ­ ì‹œê°„ì´ ì ìš©ë˜ì–´ì„œ new Date()ê°€ ë‚˜ì˜¤ì§€ëŠ” ì•Šì•˜ì–´ìš”.).
getTimezoneOffset()ì˜ ë°˜í™˜ ê°’ì´ UTC ì‹œê°„ì—ì„œ ë¡œì»¬ ì‹œê°„ì„ ëº€ ê°’ì´ê¸° ë•Œë¬¸ì— -9ê°€ ë‚˜ì™€ìš”. setSystemTimeì—ëŠ” ê³„ì‚°í•œ(í˜„ìž¬ ì‹œê°„ + ì‹œê°„ \* ë¶„ \* ì´ˆ \* ë°€ë¦¬ì´ˆ) timestampê°’ì„ ë„£ì–´ì¤¬ì–´ìš”.

setSystemTime í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì‹œë ¤ë©´ ë‘ ë°©ë²• ì¤‘ í•˜ë‚˜ë¥¼ í•´ì•¼ í•´ìš”.
1. ì£¼ì„ ì²˜ë¦¬í•œ jest.useFakeTimers í•¨ìˆ˜ë¥¼ ë¨¼ì € í˜¸ì¶œí•´ì•¼ í•´ìš”.
2. package.jsonì— ìžˆëŠ” "jest"ì— ì•„ëž˜ ì½”ë“œì²˜ëŸ¼ ì¶”ê°€í•´ì•¼ í•´ìš”.

```json
"jest": {
	// ...ì¤‘ëžµ
	"fakeTimers": {
		"enableGlobally": true
	}
}
```

ì‹œê°„ì„ ì§ì ‘ ë°”ê¾¸ëŠ” ë°©ë²•ê³¼ ë¹„ìŠ·í•˜ê²Œ ì´ì œ í…ŒìŠ¤íŠ¸ í™˜ê²½ì—ì„œë§Œ ì‹œê°„ì„ ë³€ê²½í•  ìˆ˜ ìžˆê²Œ ë˜ì—ˆì–´ìš”.
ì°¾ì€ ê²°ê³¼ê°€ ë‹¨ìˆœí•˜ì§€ë§Œ ì´ ê³¼ì •ì„ ì°¾ê¸°ê¹Œì§€ ì‹œê°„ì´ ê±¸ë ¸ë˜ ê²Œ ì•„ì‰½ë„¤ìš” ðŸ¥²
### JEST extension í…ŒìŠ¤íŠ¸ ì½”ë“œ ì‹¤í–‰ ë‹¨ì¶•í‚¤ 
ì´ë²ˆì— jestë¥¼ ì“°ë©´ì„œ ë§¤ë²ˆ ëª¨ë“  í…ŒìŠ¤íŠ¸ê°€ ëŒì•„ê°€ëŠ” ê²Œ ë²ˆê±°ë¡­ë‹¤ê³  ëŠê»´ì¡Œì–´ìš”. ê·¸ëž˜ì„œ í•˜ë‚˜ë§Œ ëŒì•„ê°ˆ ìˆ˜ ìžˆê²Œ settings.jsonì— jest.runModeë¥¼ `"type": "on-demand"`ë¡œ ë³€ê²½í•˜ë©´ ì›í•˜ëŠ” ê²ƒë§Œ ë”°ë¡œ ì‹¤í–‰í•  ìˆ˜ ìžˆì–´ìš”.
ë”°ë¡œ ì‹¤í–‰í•˜ëŠ” ê±´ ì¢‹ì•˜ì§€ë§Œ, ë§ˆìš°ìŠ¤ë¡œ ëˆŒëŸ¬ì„œ ì¼ì¼ì´ ì‹¤í–‰ì‹œì¼œì•¼ í•˜ëŠ” ê²Œ ë²ˆê±°ë¡œì› ì–´ìš”.

>JEST ê´€ë ¨ ë‹¨ì¶•í‚¤ íŒì„ ì•Œë ¤ë“œë¦´ê²Œìš”!
>í…ŒìŠ¤íŠ¸ íŒŒì¼ì—ì„œ í…ŒìŠ¤íŠ¸ í•˜ë‚˜ë§Œ ëŒë¦¬ëŠ” ë‹¨ì¶•í‚¤ëŠ” `command + ; + c`ì—ìš”.

ë§Œì•½ ì´ ë‹¨ì¶•í‚¤ë¥¼ ì‚¬ìš©í•  ë• ì¡°ê±´ì´ ìžˆì–´ìš”.
- VS Codeì— jest extensionì„ ì‚¬ìš©í•˜ê³  ìžˆì–´ì•¼ í•´ìš”. 
- `command + shift + p`ë¡œ `Jest: Start All Runners`ë¥¼ ì‹¤í–‰ì‹œì¼œì•¼ í•´ìš”.
- `jest.runMode`ë¥¼ `on-demand`ë¡œ ë°”ê¿”ì•¼ í•´ìš”(ë³´í†µ ìžë™ì€ ëª¨ë“  í…ŒìŠ¤íŠ¸ë¥¼ ëŒë¦¬ëŠ” ê±°ë¼ ì´ ë‹¨ì¶•í‚¤ê°€ í•„ìš” ì—†ì–´ìš”). ì„¤ì •í•˜ëŠ” ê±´ ìœ„ ì½”ë“œë¼ì¸ì— ì ì–´ë†¨ì–´ìš”.
- í…ŒìŠ¤íŠ¸ íŒŒì¼ì—ì„œ ì‹¤í–‰í•˜ê³ ìž í•˜ëŠ” í…ŒìŠ¤íŠ¸ í•¨ìˆ˜ì— ì»¤ì„œê°€ ì¡´ìž¬í•´ì•¼ í•´ìš”.

---

> [!quote] Reviewing what you have learned and learning anew, you are fit to be a teacher.
> â€” Confucius